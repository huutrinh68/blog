(window.webpackJsonp=window.webpackJsonp||[]).push([[35],{563:function(n,a,s){"use strict";s.r(a);var e=s(8),t=Object(e.a)({},(function(){var n=this,a=n.$createElement,s=n._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[s("p",[n._v("Trong bài này sẽ hướng dẫn cách xóa log trong container")]),n._v(" "),s("p",[n._v("Khi sử dụng docker trên server, service tự nhiên một ngày đẹp trời không hoạt động,\nlúc đó kiểm tra hệ thống thì ta thấy dung lượng của ổ cứng đã không còn nữa.\nVà lý do là do lượng log quá lớn mà container sinh ra tích tụ từ rất lâu rồi.")]),n._v(" "),s("p",[n._v("Khi đó cách giải quyết sẽ như sau:")]),n._v(" "),s("ul",[s("li",[n._v("Xác định vị trí của file log")]),n._v(" "),s("li",[n._v("Xóa nội dung file log")]),n._v(" "),s("li",[n._v("Áp dụng thêm logging rotation vào để log không bị tích tụ mà sẽ tự xóa khi quá giới hạn")])]),n._v(" "),s("h3",{attrs:{id:"xoa-log-cua-container"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#xoa-log-cua-container"}},[n._v("#")]),n._v(" Xóa log của container")]),n._v(" "),s("p",[n._v("Cách để xác định của log")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("$ docker inspect [container name] | grep -i log\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br")])]),s("p",[n._v("Nếu trên linux server thì vị trí thường là bên dưới "),s("code",[n._v("/var/lib/docker/containers/xxx-json.log")])]),n._v(" "),s("h3",{attrs:{id:"xoa-noi-dung-cua-file-log"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#xoa-noi-dung-cua-file-log"}},[n._v("#")]),n._v(" Xóa nội dung của file log")]),n._v(" "),s("p",[n._v("Dùng lệnh dưới để xóa")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("$ sudo truncate -s 0 /var/lib/docker/containers/xxx-json.log\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br")])]),s("h3",{attrs:{id:"tao-logging-rotate-cho-docker-container"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#tao-logging-rotate-cho-docker-container"}},[n._v("#")]),n._v(" Tạo logging rotate cho docker container")]),n._v(" "),s("p",[n._v("Bên trong service của docker-compose ta thêm đoạn setting sau:")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("logging:\n  driver: 'json-file'\n  options:\n    max-size: '10m'\n    max-file: '3'\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br")])]),s("p",[n._v("Ở đây đang ví dụ là cứ 10Mb thì file log sẽ được tách ra, và tối đa là có 3 files như vậy là 30Mb log tối đa.\nDo là options nên các thông số trên có thể thay đổi tùy thích\nSau đó restart lại các service")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("$ docker-compose restart\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br")])]),s("h3",{attrs:{id:"setting-global"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#setting-global"}},[n._v("#")]),n._v(" Setting global")]),n._v(" "),s("p",[n._v("Còn một cách setting nữa sẽ setting cho toàn bộ docker container chứ không cần vào docker-compose để setting cho từng service.")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("$ sudo vim /etc/docker/daemin.json\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br")])]),s("p",[n._v("Thêm vào thông tin dưới đây")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v('{\n   "log-driver": "json-file",\n   "log-opts": {"max-size": "10m", "max-file": "3"}\n}\n')])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br")])]),s("p",[n._v("Lưu setting trên lại và kiểm tra bằng lệnh")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v('$ sudo cat /etc/docker/daemin.json\n{\n   "log-driver": "json-file",\n   "log-opts": {"max-size": "10m", "max-file": "3"}\n}\n')])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br")])]),s("p",[n._v("Dùng cách này chúng ta phải restart cả docker service để load lại config cho docker")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("$ docker-compose stop\n$ sudo systemctl restart docker\n$ docker-compose restart\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br")])]),s("p",[n._v("🍺 🍺 🍺 Okie đã xong và yên tâm việc không bị file log làm tràn dung lượng nữa!")])])}),[],!1,null,null,null);a.default=t.exports}}]);